<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pets@Home</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #fff;
            text-align: center;
        }
        #debug-console {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 400px;
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.9);
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 10000;
            text-align: left;
        }
        #debug-console .error { color: #f00; }
        #debug-console .success { color: #0f0; }
        #debug-console .info { color: #0ff; }
        .header-links {
            text-align: right;
            padding: 10px 20px;
        }
        .header-links a {
            margin: 0 10px;
            text-decoration: none;
            color: #5f6368;
            font-size: 14px;
        }
        .logo {
            margin-top: 100px;
        }
        .logo h1 {
            font-size: 80px;
            font-weight: normal;
            margin-bottom: 30px;
        }
        .search-box {
            width: 60%;
            max-width: 600px;
            padding: 12px 28px;
            border: 1px solid #dadce0;
            border-radius: 24px;
            font-size: 16px;
            outline: none;
            box-shadow: none;
        }
        .buttons {
            margin-top: 30px;
        }
        .buttons button {
            padding: 10px 20px;
            margin: 5px;
            border: 1px;
            background-color: #cad2da;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }
        footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #f2f2f2;
            padding: 10px 0;
            font-size: 14px;
            color: #5f6368;
        }
        footer .footer-links {
            display: flex;
            justify-content: space-between;
            max-width: 900px;
            margin: auto;
        }
        footer .footer-links a {
            margin: 0 15px;
            color: #5f6368;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <!-- Debug Console Overlay -->
    <div id="debug-console"></div>
    
    <!-- Header Links -->
    <div class="header-links">
        <a href="#">My Account</a>
        <a href="#">My Orders</a>
    </div>

    <!-- Logo -->
    <div class="logo">
        <h1>
            <span style="color: #4285F4;">P</span>
            <span style="color: #EA4335;">e</span>
            <span style="color: #FBBC05;">t</span>
            <span style="color: #4285F4;">s</span>
            <span style="color: #34A853;">@</span>
            <span style="color: #EA4335;">H</span>
            <span style="color: #4285F4;">o</span>
            <span style="color: #EA4335;">m</span>
            <span style="color: #4285F4;">e</span>
        </h1>
    </div>

    <!-- Search Box -->
    <input type="text" class="search-box" placeholder="Search for food, treats, toys & more..." />

    <!-- Buttons -->
    <div class="buttons">
        <button>Pets Search</button>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-links">
            <div>
                <a href="#">About</a>
                <a href="#">Advertising</a>
                <a href="#">Business</a>
                <a href="#">How Search Works</a>
            </div>
            <div>
                <a href="#">Privacy</a>
                <a href="#">Terms</a>
                <a href="#">Settings</a>
            </div>
        </div>
    </footer>
<script type='text/javascript'>
    // Debug logger to display on page
    const debugConsole = document.getElementById('debug-console');
    function debugLog(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = document.createElement('div');
        logEntry.className = type;
        logEntry.textContent = `[${timestamp}] ${message}`;
        debugConsole.appendChild(logEntry);
        debugConsole.scrollTop = debugConsole.scrollHeight;
        
        // Also log to console
        if (type === 'error') console.error(message);
        else if (type === 'success') console.log(message);
        else console.info(message);
    }

    async function initEmbeddedMessaging() {
        try {
            debugLog('Fetching auth token...', 'info');
            // Wait for the authToken to be fetched
            const authToken = await getAuthToken();

            if (!authToken) {
                debugLog('Auth token not found!', 'error');
                console.error('AnuragTesting4 authToken value not found.');
                return;
            }
            debugLog('Auth token received: ' + authToken, 'success');

            // Ensure embeddedservice_bootstrap is defined before using it
            if (typeof embeddedservice_bootstrap === 'undefined') {
                debugLog('embeddedservice_bootstrap is undefined!', 'error');
                console.error('AnuragTesting4 embeddedservice_bootstrap is not defined.');
                return;
            }
            debugLog('embeddedservice_bootstrap found', 'success');

            embeddedservice_bootstrap.settings.language = 'en_US';
            
            debugLog('Starting Embedded Service initialization...', 'info');
            console.log('Starting Embedded Service initialization...');
            console.log('Auth token:', authToken);
            
            debugLog('Calling embeddedservice_bootstrap.init()...', 'info');
            console.log('Calling embeddedservice_bootstrap.init()...');
            
            embeddedservice_bootstrap.init(
                '00D3M0000000bcP',
                'AnuragGitHubMessingChannel',
                'https://petsathome00001--preprod.sandbox.my.site.com/ESWashutoshGithubChannelf1770049934495',
                {
                    scrt2URL: 'https://petsathome00001--preprod.sandbox.my.salesforce-scrt.com'
                }
            );
            debugLog('✅ Init called successfully', 'success');
            debugLog('Waiting for widget to be ready...', 'info');
            
            // Wait for the widget to be fully ready before setting context
            // Need to wait for the widget to render AND be ready for API calls
            setTimeout(() => {
                if (embeddedservice_bootstrap.utilAPI && embeddedservice_bootstrap.utilAPI.setSessionContext) {
                    debugLog('Widget ready, setting session context...', 'info');
                    embeddedservice_bootstrap.utilAPI.setSessionContext([
                        {
                            name: "_AgentContext",
                            value: {
                                valueType: "StructuredValue",
                                value: {
                                    B2CAuthorizationToken: authToken,
                                    currentPage: window.location.href
                                }
                            }
                        }
                    ])
                    .then(() => {
                        debugLog('✅ Context set successfully with auth token', 'success');
                        console.log('✅ Context set successfully with auth token');
                    })
                    .catch((error) => {
                        debugLog('❌ Error setting context: ' + error.message, 'error');
                        console.error('❌ Error setting context:', error);
                    });
                } else {
                    debugLog('⚠️ utilAPI still not available after 3 seconds', 'error');
                }
            }, 3000); // Wait 3 seconds for widget to be fully ready
            
            // Check if widget appears in DOM
            setTimeout(() => {
                const widget = document.querySelector('.embeddedMessagingFrame, .embeddedMessagingConversationButton, [class*="embedded"], iframe[title*="chat"], iframe[title*="messaging"]');
                if (widget) {
                    debugLog('✅ Widget found in DOM!', 'success');
                } else {
                    debugLog('⚠️ Widget not found after 5 seconds', 'error');
                }
            }, 5000);
            console.log('✅ Init called successfully');
        } catch (err) {
            debugLog('❌ ERROR: ' + err.message, 'error');
            console.error('AnuragTesting4 Error loading Embedded Messaging: ', err);
        }
    }

    // Mock function to simulate fetching the authToken
    async function getAuthToken() {
        // Replace this with the actual logic to fetch the authToken
        return "sampleAuthToken12345";
    }

    // Wait for the embeddedservice_bootstrap script to load before initializing
    window.addEventListener('load', () => {
        debugLog('Page loaded, checking for embeddedservice_bootstrap...', 'info');
        console.log('Page loaded, checking for embeddedservice_bootstrap...');
        if (typeof embeddedservice_bootstrap !== 'undefined') {
            debugLog('✅ embeddedservice_bootstrap found', 'success');
            console.log('✅ embeddedservice_bootstrap found, initializing...');
            initEmbeddedMessaging();
        } else {
            debugLog('❌ embeddedservice_bootstrap script did not load!', 'error');
            debugLog('Check Salesforce URL and CORS settings', 'error');
            console.error('❌ embeddedservice_bootstrap script did not load.');
            console.error('Check if the Salesforce URL is accessible and CORS is configured properly.');
        }
    });
</script>
<script type='text/javascript' src='https://petsathome00001--preprod.sandbox.my.site.com/ESWashutoshGithubChannelf1770049934495/assets/js/bootstrap.min.js' 
    onerror="debugLog('❌ Failed to load bootstrap.min.js', 'error'); console.error('❌ Failed to load bootstrap.min.js from Salesforce. Check network/CORS settings.');"></script>
</body>
</html>
